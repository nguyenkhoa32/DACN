<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liên Hệ</title>
    <link rel="stylesheet" href="nhanvien.css">
</head>
<body>

<div class="dashboard-container">

    <aside class="sidebar">
        <h2 class="brand">Quản Lý Sân</h2>

        <ul class="nav">
            <li><a href="dat_san.html">Thông tin đặt sân</a></li>
            <li><a href="lien_he.html" class="active">Liên hệ</a></li>
            <li><a href="nhanvien.html">Quay lại nhân viên</a></li>
        </ul>
    </aside>

   <main class="main">
    <h1>Liên Hệ Nhân Viên</h1>

    <div class="info-chat-container" style="display:flex; gap:20px; flex-wrap:wrap;">

        <!-- Thông tin nhân viên -->
        <section class="card" style="flex:1 1 300px; padding:20px;">
            <p>Nhân Viên Trực Sân</p>
            <p>Email: nhanvientrucsan1@gmail.com</p>
            <p>Hotline: 0900 123 456</p>
        </section>

        <!-- Khung trao đổi với user -->
        <section class="chat-container" style="flex:1 1 400px; padding:20px; border:1px solid #ccc; border-radius:10px; background-color:#f9f9f9;">
            <h2>Danh Sách Tin Nhắn</h2>
            <div id="contactList" style="margin-bottom:10px; max-height:200px; overflow-y:auto;"></div>

            <div id="chatBox" style="display:none;">
                <h3 id="chatUser"></h3>
                <div id="chatMessages" style="border:1px solid #ccc; padding:10px; height:250px; overflow-y:auto; border-radius:8px; background-color:#fff;"></div>
                <div style="margin-top:10px; display:flex; gap:5px;">
                    <input type="text" id="replyInput" placeholder="Nhập tin nhắn..." style="flex:1; padding:8px; border-radius:6px; border:1px solid #ccc;">
                    <button onclick="sendReply()" style="padding:8px 15px; border:none; border-radius:6px; background-color:#3498db; color:white; cursor:pointer;">Gửi</button>
                </div>
            </div>
        </section>

    </div>
</main>

<script>
let contacts = JSON.parse(localStorage.getItem("contactMessages")) || [];

const contactList = document.getElementById("contactList");
const chatBox = document.getElementById("chatBox");
const chatMessages = document.getElementById("chatMessages");
const chatUser = document.getElementById("chatUser");

let currentUserIndex = -1;

// Load danh sách liên hệ
function loadContacts() {
    contactList.innerHTML = "";
    contacts.forEach((c, index) => {
        const div = document.createElement("div");
        div.className = "contact-card";
        div.style.border = "1px solid #ccc";
        div.style.padding = "10px";
        div.style.marginBottom = "5px";
        div.style.cursor = "pointer";
        div.innerHTML = `<strong>${c.name}</strong><br>${c.chat.length ? c.chat[c.chat.length-1].text.substring(0,40) + "..." : "Chưa có tin nhắn"}`;
        div.onclick = () => openChat(index);
        contactList.appendChild(div);
    });
}

loadContacts();

// Mở chat với user
function openChat(index){
    currentUserIndex = index;
    chatUser.innerText = "Trao đổi với: " + contacts[index].name;
    chatMessages.innerHTML = "";
    contacts[index].chat.forEach(msg => {
        const bubble = document.createElement("div");
        bubble.innerText = msg.text + " (" + msg.time + ")";
        bubble.style.margin = "5px";
        bubble.style.padding = "5px 10px";
        bubble.style.borderRadius = "8px";
        bubble.style.maxWidth = "70%";
        bubble.style.backgroundColor = msg.from === "staff" ? "#3498db" : "#2ecc71";
        bubble.style.color = "white";
        bubble.style.alignSelf = msg.from === "staff" ? "flex-start" : "flex-end";
        chatMessages.appendChild(bubble);
    });
    chatBox.style.display = "block";
}

// Gửi trả lời từ nhân viên
function sendReply(){
    const input = document.getElementById("replyInput");
    const text = input.value.trim();
    if(!text || currentUserIndex === -1) return;

    contacts[currentUserIndex].chat.push({
        from: "staff",
        text: text,
        time: new Date().toLocaleString()
    });

    localStorage.setItem("contactMessages", JSON.stringify(contacts));
    input.value = "";
    openChat(currentUserIndex);
    loadContacts(); // cập nhật preview tin nhắn
}
// Tự động cập nhật lịch sử chat mỗi 3 giây
setInterval(() => {
    if(currentUserIndex !== -1) {
        // Reload danh sách contact và chat hiện tại
        contacts = JSON.parse(localStorage.getItem("contactMessages")) || [];
        openChat(currentUserIndex);
        loadContacts();
    }
}, 3000);

</script>

</div>

</body>
</html>
